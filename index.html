<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>El Mensaje del Mercader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- TipografÃ­a Ã¡rabe/mÃ­stica -->
  <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ESTILOS GENERALES â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Scheherazade New", serif;
    }

    body {
      background: radial-gradient(circle at top, #143a52 0%, #120c16 50%, #050308 100%);
      color: #fdf7e7;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .game-container {
      width: 100%;
      max-width: 480px;
      padding: 16px;
    }

    .card {
      background: rgba(14, 9, 20, 0.92);
      border-radius: 18px;
      padding: 20px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 215, 0, 0.25);
      position: relative;
      overflow: hidden;
    }

    h1, h2, h3 {
      margin-bottom: 12px;
      text-align: center;
    }

    h1 { font-size: 2rem; }

    p {
      margin-bottom: 10px;
      line-height: 1.5;
      font-size: 1.05rem;
    }

    .small { font-size: 0.95rem; opacity: 0.9; }

    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” BOTONES â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    .btn {
      display: inline-block;
      margin-top: 16px;
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      font-size: 1.1rem;
      cursor: pointer;
      background: linear-gradient(135deg, #ffce54, #f6a623);
      color: #3a1800;
      font-weight: 700;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.45);
      width: 100%;
      transition: 0.2s;
    }

    .btn:hover { transform: scale(1.03); }

    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” PANTALLAS â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    .screen { display: none; }
    .screen.active { display: block; }

    .zellige-line {
      height: 8px;
      width: 100%;
      margin: 10px 0 16px;
      background-image:
        linear-gradient(45deg, #006d77 25%, transparent 25%),
        linear-gradient(-45deg, #e29578 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #ffddd2 75%),
        linear-gradient(-45deg, transparent 75%, #83c5be 75%);
      background-size: 14px 14px;
      opacity: 0.85;
    }

    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” PERGAMINOS â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    .scroll-box {
      background: radial-gradient(circle at top, #f5e1b5 0%, #e0c28b 40%, #c9a56e 100%);
      border-radius: 14px;
      padding: 12px 14px;
      margin: 10px 0;
      color: #3d2a12;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      border: 1px solid rgba(112, 78, 26, 0.6);
      position: relative;
      overflow: hidden;
    }

    .scroll-box::before,
    .scroll-box::after {
      content: "";
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid rgba(255, 255, 255, 0.5);
      top: -20px;
      filter: blur(1px);
      opacity: 0.4;
    }

    .scroll-box::before { left: -20px; }
    .scroll-box::after { right: -20px; }

    .scroll-text { font-size: 1rem; line-height: 1.45; }

    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” AVATAR DEL MERCADER â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    .merchant-frame {
      margin: 6px auto 14px;
      width: 160px;
      height: 160px;
      border-radius: 26px;
      padding: 6px;
      background-image:
        linear-gradient(135deg, #ffd54f, #f6a623, #ffb74d),
        linear-gradient(45deg, #006d77 25%, transparent 25%),
        linear-gradient(-45deg, #e29578 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #ffddd2 75%),
        linear-gradient(-45deg, transparent 75%, #83c5be 75%);
      background-origin: border-box;
      background-clip: padding-box, border-box, border-box, border-box, border-box;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
      position: relative;
      animation: merchant-glow 4s ease-in-out infinite alternate;
    }

    @keyframes merchant-glow {
      0% { box-shadow: 0 6px 18px rgba(0,0,0,0.6); }
      100% { box-shadow: 0 6px 26px rgba(255, 215, 0, 0.5); }
    }

    .merchant-inner {
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background: radial-gradient(circle at top, #f5e1b5 0%, #d0a96a 40%, #7c4a2e 100%);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .merchant-avatar {
      width: 90px;
      height: 90px;
      position: relative;
    }

    .merchant-avatar::before {
      content: "";
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,0.5), transparent 55%),
        linear-gradient(180deg, #362116 0%, #1e130c 100%);
      top: 5px;
      left: 15px;
      box-shadow: 0 0 0 3px rgba(250, 240, 210, 0.7);
    }

    .merchant-avatar::after {
      content: "";
      position: absolute;
      width: 80px;
      height: 60px;
      border-radius: 50% 50% 40% 40%;
      background: linear-gradient(135deg, #5e3023, #3b1f17);
      top: 0;
      left: 5px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.6);
    }

    .merchant-body {
      position: absolute;
      bottom: -5px;
      left: 8px;
      width: 74px;
      height: 60px;
      border-radius: 50% 50% 10px 10px;
      background: linear-gradient(135deg, #4a2b18, #23120b);
      box-shadow: 0 -3px 8px rgba(0,0,0,0.6);
    }

    .merchant-spark {
      position: absolute;
      font-size: 1.2rem;
      color: #ffecb3;
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.9);
      animation: spark-float 3s ease-in-out infinite;
    }

    .merchant-spark:nth-child(1) { top: 10px; right: 12px; animation-delay: 0.2s; }
    .merchant-spark:nth-child(2) { bottom: 8px; left: 16px; animation-delay: 0.7s; }

    @keyframes spark-float {
      0% { transform: translateY(0); opacity: 0.7; }
      50% { transform: translateY(-6px); opacity: 1; }
      100% { transform: translateY(0); opacity: 0.6; }
    }

    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” OBJETOS â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    .objects-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 14px;
    }

    .object-card {
      border-radius: 14px;
      padding: 18px;
      background: rgba(44, 29, 55, 0.85);
      border: 1px solid rgba(255, 215, 0, 0.3);
      text-align: center;
      cursor: pointer;
      transition: 0.2s;
    }

    .object-card span {
      font-size: 2rem;
      display: block;
    }

    .object-card:hover {
      transform: scale(1.06);
      box-shadow: 0 4px 14px rgba(0,0,0,0.5);
    }

    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” COLORES â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    .colors-row {
      display: flex;
      gap: 12px;
      margin-top: 18px;
      flex-wrap: wrap;
    }

    .color-box {
      flex: 1;
      min-width: 90px;
      height: 80px;
      border-radius: 14px;
      padding: 8px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: flex-end;
      border: 2px solid rgba(255, 255, 255, 0.4);
      transition: 0.2s;
      text-align: center;
    }

    .color-box.clicked {
      transform: scale(0.95);
      opacity: 0.7;
      outline: 3px solid #ffd54f;
    }

    .color-azul { background: linear-gradient(135deg, #1a4f7a, #1e88e5); }
    .color-ocre { background: linear-gradient(135deg, #bf8b3b, #ffb74d); }
    .color-verde { background: linear-gradient(135deg, #00796b, #26a69a); }

    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” DESIERTO â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    .desert-area {
      margin-top: 14px;
      border-radius: 18px;
      height: 200px;
      background:
        linear-gradient(to bottom,
          #0b1424 0%,
          #15233c 45%,
          #c96f28 46%,
          #f4a261 100%
        );
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 215, 0, 0.25);
      box-shadow: inset 0 0 25px rgba(0,0,0,0.7);
    }

    .desert-area::before {
      content: "";
      position: absolute;
      top: 10px;
      right: 16px;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: radial-gradient(circle, #fffdf5 0%, #f5ecd2 50%, rgba(255,255,255,0) 70%);
      opacity: 0.8;
      filter: blur(1px);
    }

    .desert-area::after {
      content: "âœ¦   âœ§   âœ¦   âœ§";
      position: absolute;
      top: 0;
      left: 12px;
      font-size: 1.3rem;
      color: rgba(255,255,255,0.5);
      letter-spacing: 22px;
      animation: stars-twinkle 4s ease-in-out infinite alternate;
    }

    @keyframes stars-twinkle {
      0% { opacity: .45; }
      100% { opacity: .9; }
    }

    .desert-haze {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 120%, rgba(255,225,170,0.25), transparent 70%);
      animation: haze-move 6s ease-in-out infinite alternate;
      pointer-events: none;
    }

    @keyframes haze-move {
      0% { transform: translateY(5px); opacity: .7; }
      100% { transform: translateY(-8px); opacity: 1; }
    }

    .dune {
      position: absolute;
      width: 140%;
      height: 100px;
      left: -20%;
      border-radius: 50%;
      background: linear-gradient(to right, #e89a4a, #c0742e);
      opacity: 0.25;
      filter: blur(4px);
    }

    .dune:nth-child(1) { bottom: 10px; }
    .dune:nth-child(2) { bottom: 35px; opacity: 0.2; background: linear-gradient(to right, #e8b16a, #c8883b); }
    .dune:nth-child(3) { bottom: 55px; opacity: 0.15; background: linear-gradient(to right, #f3c98a, #d8a35a); }

    .light {
      position: absolute;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: radial-gradient(circle, #fff3b0 0%, #ffd95b 30%, rgba(255,200,0,0.1) 70%);
      box-shadow:
        0 0 15px rgba(255,240,150,0.9),
        0 0 40px rgba(255,210,100,0.7),
        0 0 60px rgba(255,185,75,0.5);
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #5d3c11;
      font-weight: bold;
      font-size: 0.9rem;
      animation: light-pulse 2s ease-in-out infinite;
      transition: left 1s ease-out, top 1s ease-out;
    }

    @keyframes light-pulse {
      0% { transform: scale(0.95); }
      50% { transform: scale(1.15); }
      100% { transform: scale(0.95); }
    }

    /* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” FINAL: CAJA Y ANIMACIONES â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
    .closed {
      background: radial-gradient(circle at top, #f7e3b2 0%, #d8c28a 40%, #ba995d 100%);
      border: 3px solid #8a6b3b;
      height: 180px;
      position: relative;
      border-radius: 14px;
      box-shadow: 0 0 18px rgba(255,215,0,0.35);
      overflow: hidden;
    }

    .lid-static {
      position: absolute;
      width: 120%;
      height: 50%;
      top: 0;
      left: -10%;
      background: linear-gradient(135deg, #c9a56e, #a98247);
      border-bottom: 3px solid #7a5a32;
      border-radius: 14px;
      box-shadow: 0 6px 10px rgba(0,0,0,0.5);
    }

    .closed::after {
      content: "â˜¾ âœ§";
      position: absolute;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.3rem;
      color: #4b3318;
      opacity: 0.6;
    }

    .final-box {
  margin: 0 auto;
  width: 260px;
  height: auto;                 /* Se adapta al contenido */
  padding: 0;                   /* Sin caja amarilla */
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;

  background: transparent !important;     /* ğŸš€ Caja abierta SIN fondo */
  border: none !important;                /* ğŸš€ Sin marco */
  box-shadow: none !important;            /* ğŸš€ Sin sombra de caja */

  position: relative;
  overflow: visible;                      /* Permite ver las estrellas */
  transform-origin: top;
  animation: box-open 1.5s ease-out forwards;
}

    @keyframes box-open {
      0% { transform: rotateX(90deg); opacity: 0; }
      100% { transform: rotateX(0deg); opacity: 1; }
    }

    .lid {
      position: absolute;
      width: 120%;
      height: 50%;
      top: 0;
      left: -10%;
      background: linear-gradient(135deg, #e4c88f, #c19a56);
      border-bottom: 3px solid #7a5a32;
      border-radius: 14px;
      transform-origin: top;
      animation: lid-open 1.8s ease forwards;
      box-shadow: 0 6px 14px rgba(0,0,0,0.6);
    }

    @keyframes lid-open {
      0% { transform: rotateX(0deg); }
      100% { transform: rotateX(75deg) translateY(-6px); }
    }

    .inner-glow {
      position: absolute;
      inset: 40% 8% 10%;
      background: radial-gradient(circle at top, rgba(255,255,255,0.95), rgba(255,223,128,0.9), rgba(255,193,7,0.2));
      filter: blur(1px);
      opacity: 0;
      animation: glow-rise 1.6s ease-out forwards;
      animation-delay: 0.8s;
    }

    @keyframes glow-rise {
      0% { opacity: 0; transform: translateY(12px) scale(0.96); }
      100% { opacity: 1; transform: translateY(-6px) scale(1.02); }
    }

    .sparkles {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .sparkles span {
      position: absolute;
      font-size: 1.1rem;
      color: #fff8e1;
      text-shadow: 0 0 8px rgba(255,255,255,0.9);
      opacity: 0;
      animation: sparkle-pop 2s ease-out infinite;
    }

    .sparkles span:nth-child(1) { top: 20%; left: 18%; animation-delay: 0.3s; }
    .sparkles span:nth-child(2) { top: 15%; right: 15%; animation-delay: 0.7s; }
    .sparkles span:nth-child(3) { bottom: 18%; left: 30%; animation-delay: 1.1s; }
    .sparkles span:nth-child(4) { bottom: 22%; right: 25%; animation-delay: 1.5s; }

    @keyframes sparkle-pop {
      0% { transform: translateY(6px) scale(0.7); opacity: 0; }
      40% { transform: translateY(-4px) scale(1); opacity: 1; }
      100% { transform: translateY(-10px) scale(0.8); opacity: 0; }
    }

    .final-card-text {
      position: relative;
      z-index: 5;
      text-align: center;
      padding-top: 30px;
      color: #3b2714;
    }

    .camel-container {
      margin-top: 20px;
      height: 80px;
      overflow: hidden;
      position: relative;
    }

    .camel {
      position: absolute;
      left: -80px;
      bottom: 0;
      font-size: 3.2rem;
      animation: camel-walk 7s linear forwards, camel-bob 1s infinite ease-in-out;
    }

    @keyframes camel-walk {
      0% { transform: translateX(0); }
      100% { transform: translateX(140vw); }
    }

    @keyframes camel-bob {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }

  </style>
</head>

<body>
  <div class="game-container">
    <div class="card">

      <!-- ğŸŸ£ INTRO -->
      <div id="screen-intro" class="screen active">
        <h1>El Mensaje del Mercader</h1>
        <div class="zellige-line"></div>

        <p>En una noche silenciosa, mientras las estrellas vigilan el cielo, recibes un mensaje...</p>

        <p style="font-style: italic; text-align:center;">
          â€œQuien siga la luz del desierto, hallarÃ¡ su destino. Firmado: El Mercaderâ€
        </p>

        <button class="btn" onclick="goTo('screen-story')">Hablar con el Mercader</button>
      </div>

      <!-- ğŸŸ  HISTORIA -->
      <div id="screen-story" class="screen">
        <h2>El Mercader de las Estrellas</h2>
        <div class="zellige-line"></div>

        <div class="merchant-frame">
          <div class="merchant-inner">
            <div class="merchant-avatar">
              <div class="merchant-body"></div>
            </div>
            <div class="merchant-spark">âœ§</div>
            <div class="merchant-spark">âœ¨</div>
          </div>
        </div>

        <div class="scroll-box">
          <p class="scroll-text">
            Caminas entre casas con historia. Un mercader anciano te mira como si te hubiera estado esperando desde siempre.
          </p>
        </div>

        <div class="scroll-box">
          <p class="scroll-text" style="font-style: italic;">
            â€œHe viajado por dunas, montaÃ±as y maresâ€¦ y sÃ© cuÃ¡ndo un corazÃ³n estÃ¡ listo para escuchar su destino.â€
          </p>
        </div>

        <div class="scroll-box">
          <p class="scroll-text">Te entrega una pequeÃ±a caja con <strong>tres cerraduras</strong>.</p>
          <p class="scroll-text" style="font-style: italic;">
            â€œSolo quien supera las tres pruebas de mi tierra podrÃ¡ abrirla. Pero no temasâ€¦ las estrellas caminan contigo.â€
          </p>
        </div>

        <button class="btn" onclick="goTo('screen-test1')">Comenzar la primera prueba</button>
      </div>

      <!-- ğŸ”µ PRUEBA 1 -->
      <div id="screen-test1" class="screen">
        <h2>Prueba 1: El Zoco de los Ecos</h2>
        <div class="zellige-line"></div>

        <p>Elige un objeto del zoco. Cada uno guarda un secreto, una historia, una parte del viajeâ€¦</p>

        <p class="small">El mercader susurra: â€œTu elecciÃ³n revela mÃ¡s de lo que imaginas.â€</p>

        <div class="objects-grid">
          <div class="object-card" data-item="te" onclick="test1(this)">
            <span>ğŸµ</span><p>Tetera de menta</p>
          </div>
          <div class="object-card" data-item="minarete" onclick="test1(this)">
            <span>ğŸ•Œ</span><p>Minarete</p>
          </div>
          <div class="object-card" data-item="artesano" onclick="test1(this)">
            <span>ğŸ› ï¸</span><p>Artesano</p>
          </div>
          <div class="object-card" data-item="camello" onclick="test1(this)">
            <span>ğŸª</span><p>Camello</p>
          </div>
        </div>

        <p id="msg1" style="margin-top:12px; text-align:center; font-style:italic;"></p>
      </div>

      <!-- ğŸŸ¡ PRUEBA 2 -->
      <div id="screen-test2" class="screen">
        <h2>Prueba 2: Los Colores de la Historia</h2>
        <div class="zellige-line"></div>

        <p>Toca los tres colores. Cada uno esconde un fragmento de la historia.</p>

        <div class="colors-row">
          <div class="color-box color-azul" data-color="azul" onclick="colorClick(this)">
            Azul Majorelle
          </div>
          <div class="color-box color-ocre" data-color="ocre" onclick="colorClick(this)">
            Ocre del Desierto
          </div>
          <div class="color-box color-verde" data-color="verde" onclick="colorClick(this)">
            Verde de Zellige
          </div>
        </div>

        <p id="msg2" style="margin-top:12px; text-align:center; font-style:italic;"></p>
      </div>

      <!-- ğŸŸ¤ PRUEBA 3 -->
      <div id="screen-test3" class="screen">
        <h2>Prueba 3: Las Dunas del SueÃ±o</h2>
        <div class="zellige-line"></div>

        <p>Toca la estrella cuando se detenga. SÃ­guela tres vecesâ€¦ ella conoce el camino.</p>

        <div class="desert-area" id="desert-area">
          <div class="dune"></div>
          <div class="dune"></div>
          <div class="dune"></div>
          <div class="desert-haze"></div>

          <div class="light" id="light" onclick="lightClick()">â˜…</div>
        </div>

        <p id="msg3" style="margin-top:12px; text-align:center; font-style:italic;"></p>
      </div>

      <!-- ğŸŸ¢ FINAL -->
      <div id="screen-final" class="screen">
        <h2>El Mercader Tiene Algo Que Decirte...</h2>
        <div class="zellige-line"></div>

        <div class="merchant-frame">
          <div class="merchant-inner">
            <div class="merchant-avatar">
              <div class="merchant-body"></div>
            </div>
            <div class="merchant-spark">âœ§</div>
            <div class="merchant-spark">âœ¨</div>
          </div>
        </div>

        <p style="font-style:italic; text-align:center; margin-bottom:10px;">
          â€œHas escuchado los ecos del zocoâ€¦ Has unido los colores de mi tierraâ€¦ Has seguido la luz del desierto.â€
        </p>

        <p style="text-align:center;">â€œAhora estÃ¡s lista para conocer aquello que guardÃ© para ti.â€</p>

        <p style="font-style:italic; text-align:center; margin-top:8px;">
          â€œDentro de esta caja se esconde un destinoâ€¦ Cuando tu corazÃ³n estÃ© preparado, Ã¡brela.â€
        </p>

        <!-- Caja cerrada -->
        <div class="final-box closed" id="closed-box" style="cursor:pointer; margin-top:18px;">
          <div class="lid-static"></div>
          <p style="text-align:center; margin-top:90px; opacity:0.85; color:#3b2714;">
            (Caja cerrada)
          </p>
        </div>

        <button class="btn" style="margin-top:20px;" onclick="openFinalBox()">Abrir la caja</button>

        <!-- Caja abierta -->
        <div id="open-box-container" style="display:none; margin-top:10px;">

          <div class="final-box" id="open-box">
            <div class="lid"></div>
            <div class="inner-glow"></div>
            <div class="sparkles">
              <span>âœ§</span><span>âœ¨</span><span>âœ§</span><span>âœ¨</span>
            </div>

            <div class="final-card-text">
              <p style="font-weight:700; font-size:1.5rem; color:#000;">
                ğŸ§³ğŸ§³ğŸ§³ Viaje a Marruecos ğŸ§³ğŸ§³ğŸ§³
              </p>
            </div>
          </div>

          <p id="birthday-msg"
             style="text-align:center; margin-top:0px; font-size:1.3rem;
                    opacity:0; transition: opacity 1.2s ease;">
            ğŸ‰ğŸ‰ğŸ‰ Â¡Feliz cumpleaÃ±os, Habibi! ğŸ‰ğŸ‰ğŸ‰
          </p>

          <div class="camel-container">
            <div class="camel">ğŸª</div>
          </div>
        </div>

        <button class="btn" onclick="restart()" style="margin-top:20px;">
          Volver al inicio
        </button>
      </div>

    </div>
  </div>

  <!-- â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” JAVASCRIPT â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” -->

<script>
/* â€”â€”â€” Cambio de pantallas â€”â€”â€” */
function goTo(id){
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');

  if(id === "screen-test3") resetLight();
  if(id === "screen-final") resetAnimations();
}

/* â€”â€”â€” Prueba 1 â€”â€”â€” */
function test1(el){
  const item = el.dataset.item;
  const mensajes = {
    te: "â€œLa tetera guarda el arte de la paciencia y la hospitalidad.â€",
    minarete: "â€œEl minarete guÃ­a a los viajeros cuando la noche oculta los caminos.â€",
    artesano: "â€œLos artesanos del cobre esculpen historias con cada golpe.â€",
    camello: "â€œEl camello es el guardiÃ¡n del desiertoâ€¦ sin Ã©l, no hay travesÃ­a posible.â€"
  };

  document.getElementById("msg1").textContent = mensajes[item];
  setTimeout(()=>goTo('screen-test2'), 5000);
}

/* â€”â€”â€” Prueba 2 â€”â€”â€” */
let colors = new Set();

function colorClick(el){
  const c = el.dataset.color;

  if(!colors.has(c)){
    colors.add(c);
    el.classList.add("clicked");

    const mensajes = {
      azul: "â€œEl azul Majorelle protege del mal de ojo y calma el alma.â€",
      ocre: "â€œEl ocre es el color de las dunas eternas y de las kasbahs antiguas.â€",
      verde:"â€œEl verde del zellige simboliza vida, paz y renacimiento.â€"
    };

    document.getElementById("msg2").textContent = mensajes[c];
  }

  if(colors.size === 3){
    setTimeout(()=>{
      document.getElementById("msg2").textContent = "â€œHas unido los colores de la historia.â€";
      setTimeout(()=>goTo('screen-test3'),3000);
    },5000);
  }
}

/* â€”â€”â€” Prueba 3 â€”â€”â€” */
let clicks = 0;

function resetLight(){
  const light = document.getElementById("light");
  const area  = document.getElementById("desert-area");
  const r     = area.getBoundingClientRect();

  const x = Math.random() * (r.width - 40) + 10;
  const maxY = Math.max(0, r.height * 0.45 - 40);
  const y = Math.random() * maxY + 10;

  light.style.left = x + "px";
  light.style.top  = y + "px";
}

function lightClick(){
  clicks++;

  if(clicks < 3){
    document.getElementById("msg3").textContent =
      `â€œHas seguido la estrella ${clicks} vez${clicks>1 ? "es" : ""}â€¦â€`;
    resetLight();
  } else {
    document.getElementById("msg3").textContent =
      "â€œLa estrella te guiarÃ¡ al destino finalâ€¦â€";
    setTimeout(()=>goTo('screen-final'), 5000);
  }
}

/* â€”â€”â€” Final: Abrir Caja â€”â€”â€” */
function openFinalBox(){
  document.getElementById("closed-box").style.display = "none";
  document.getElementById("open-box-container").style.display = "block";

  const screen = document.getElementById("screen-final");
  const toReset = [".final-box", ".lid", ".inner-glow", ".sparkles span", ".camel"];

  toReset.forEach(sel => {
    screen.querySelectorAll(sel).forEach(el => {
      el.style.animation = "none";
      void el.offsetWidth;
      el.style.animation = "";
    });
  });

  document.getElementById("birthday-msg").style.opacity = "1";
}

/* â€”â€”â€” Final: Reset Animaciones â€”â€”â€” */
function resetAnimations(){
  const final = document.getElementById("screen-final");
  const elements = [
    ".final-box", ".lid", ".inner-glow",
    ".sparkles span", ".camel"
  ];

  elements.forEach(sel => {
    final.querySelectorAll(sel).forEach(el => {
      el.style.animation = "none";
      void el.offsetWidth;
      el.style.animation = "";
    });
  });
}

/* â€”â€”â€” Reiniciar todo â€”â€”â€” */
function restart(){
  colors.clear();
  clicks = 0;

  document.querySelectorAll('.color-box')
    .forEach(b=>b.classList.remove('clicked'));

  document.getElementById("msg1").textContent = "";
  document.getElementById("msg2").textContent = "";
  document.getElementById("msg3").textContent = "";

  document.getElementById("closed-box").style.display = "block";
  document.getElementById("open-box-container").style.display = "none";
  document.getElementById("birthday-msg").style.opacity = "0";

  goTo("screen-intro");
}
</script>

</body>
</html>
